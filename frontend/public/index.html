<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ClassEngage Health Check</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        display: flex;
        flex-direction: column;
        gap: 2rem;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background: #f7fafc;
        padding: 1rem;
      }
      section {
        background: #fff;
        padding: 2rem;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        max-width: 600px;
        width: 100%;
      }
      h1 {
        margin-top: 0;
      }
      h2 {
        font-size: 1.25rem;
        margin-bottom: 1rem;
      }
      button {
        padding: 0.75rem 1.5rem;
        font-size: 1.1rem;
        border-radius: 0.5rem;
        border: none;
        background: #2563eb;
        color: #fff;
        cursor: pointer;
        margin-bottom: 1rem;
      }
      button:hover {
        background: #1d4ed8;
      }
      pre {
        background: #0f172a;
        color: #f8fafc;
        padding: 1rem;
        border-radius: 0.5rem;
        overflow-x: auto;
      }
      .session-list {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }
      .session-card {
        background: #f1f5f9;
        padding: 1rem;
        border-radius: 0.375rem;
        border-left: 4px solid #2563eb;
      }
      .session-title {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 0.25rem;
      }
      .session-meta {
        color: #64748b;
        font-size: 0.9rem;
      }
      .empty-message {
        color: #64748b;
        font-style: italic;
        text-align: center;
        padding: 2rem;
      }
    </style>
  </head>
  <body>
    <section>
      <h1>ClassEngage Health Check</h1>
      <h2>API Status</h2>
      <button id="ping">Check Health</button>
      <pre id="output">Click the button to fetch /health</pre>
    </section>

    <section>
      <h2>Available Sessions</h2>
      <button id="fetch-sessions">Fetch Sessions</button>
      <div id="sessions-output">Click the button to load sessions</div>
    </section>

    <script>
      const pingButton = document.getElementById('ping');
      const output = document.getElementById('output');

      pingButton.addEventListener('click', async () => {
        output.textContent = 'Checking…';
        try {
          const response = await fetch('http://localhost:8000/health');
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          const data = await response.json();
          output.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
          output.textContent = `Error: ${error.message}`;
        }
      });

      const fetchSessionsButton = document.getElementById('fetch-sessions');
      const sessionsOutput = document.getElementById('sessions-output');

      fetchSessionsButton.addEventListener('click', async () => {
        sessionsOutput.textContent = 'Loading sessions…';
        try {
          const response = await fetch('http://localhost:8000/sessions');
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          const sessions = await response.json();
          
          if (sessions.length === 0) {
            sessionsOutput.innerHTML = '<div class="empty-message">No sessions available</div>';
            return;
          }

          const sessionCards = sessions.map(session => `
            <div class="session-card">
              <div class="session-title">${escapeHtml(session.title)}</div>
              <div class="session-meta">
                Code: <strong>${escapeHtml(session.code)}</strong> • 
                Host: ${escapeHtml(session.host.display_name)} • 
                Status: ${escapeHtml(session.status)}
              </div>
            </div>
          `).join('');

          sessionsOutput.innerHTML = `<div class="session-list">${sessionCards}</div>`;
        } catch (error) {
          sessionsOutput.textContent = `Error: ${error.message}`;
        }
      });

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
    </script>
  </body>
</html>
